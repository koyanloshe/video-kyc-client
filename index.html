<!DOCTYPE html>
<html lang="en-IN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <title>Video KYC</title>
    <!-- Bootstrap 5 CSS with dark mode enabled -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script>
      // Enable Bootstrap dark mode if user's system prefers dark
      if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
        document.documentElement.setAttribute("data-bs-theme", "dark");
      } else {
        document.documentElement.setAttribute("data-bs-theme", "light");
      }
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 offset-md-2 col-md-8 offset-lg-3 col-lg-6 pt-5">
          <h1>Video KYC Verification</h1>

          <div class="row mt-3">
            <div class="col-12">
              <!-- upload image & render the image uploaded -->
              <div
                class="row"
                id="image"
              >
                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="image-upload">Please share your picture</label>
                    <input
                      type="file"
                      class="form-control mt-3"
                      id="image-upload"
                      accept="image/*"
                      title="Upload your image"
                      placeholder="Choose an image file"
                    />
                  </div>
                  <p
                    id="upload-help-text"
                    class="mt-3 d-none"
                  >
                    Please review the picture and then click upload
                  </p>
                  <button
                    id="btn-upload-image"
                    class="btn btn-primary d-none"
                  >
                    Accept this Image
                  </button>
                </div>
                <div class="col-12 col-lg-6">
                  <img
                    id="image-preview"
                    class="mt-2 w-100 d-none"
                    alt="user's portrait"
                  />
                </div>
              </div>

              <script>
                document.getElementById("image-upload").addEventListener("change", function () {
                  const file = this.files[0];
                  if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                      document.getElementById("image-preview").src = e.target.result;
                      document.getElementById("image-preview").classList.toggle("d-none");
                      document.getElementById("upload-help-text").classList.toggle("d-none");
                      document.getElementById("btn-upload-image").classList.toggle("d-none");
                    };
                    reader.readAsDataURL(file);
                  }
                });
                document.getElementById("btn-upload-image").addEventListener("click", function () {
                  document.getElementById("permissions").classList.toggle("d-none");
                  document.getElementById("image").classList.toggle("d-none");
                });
              </script>
            </div>
          </div>

          <div
            class="row d-none mt-3"
            id="permissions"
          >
            <div class="col-12">
              <!-- Permissions & Initialization -->
              <p class="">
                Please allow permissions for Camera, Microphone, and Location. <br /><small class="text-danger"><i>If you don't give both permissions, you would need to start over.</i></small>
              </p>

              <button
                id="btn-permissions"
                class="btn btn-primary mb-3"
              >
                Give Permissions
              </button>
              <p
                id="location-permissions-status"
                class="mt-2"
              >
                ⚠️ Location permission pending
              </p>
              <p
                id="camera-permissions-status"
                class="mt-2"
              >
                ⚠️ Camera permission pending
              </p>
            </div>
          </div>

          <div class="row">
            <!-- Video & Overlay Section -->
            <div class="col-12 col-md-8">
              <div
                id="video-screen"
                class="mt-3 mb-3"
                style="display: block"
              >
                <div
                  id="video-container"
                  class="position-relative d-inline-block w-100"
                >
                  <video
                    id="video"
                    class="input_video w-100"
                    autoplay
                    muted
                  ></video>
                  <canvas
                    id="overlay"
                    class="output_canvas position-absolute top-0 start-0 w-100 opacity-25"
                  ></canvas>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-4">
              <p
                id="location-display"
                class="mt-2"
              ></p>
              <p
                id="faces-status"
                class="mt-2"
              ></p>
              <!-- Script Section for TTS and STT -->
              <div
                id="script-section"
                class="mt-3"
                style="display: none"
              >
                <p id="script-text">Please read aloud the following text: "Hello, I am verifying my identity."</p>
                <button
                  id="btn-start-script"
                  class="btn btn-success"
                >
                  Start TTS & Recording
                </button>
                <p
                  id="stt-result"
                  class="mt-2"
                ></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mediapipe & Other libraries -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"
      crossorigin="anonymous"
    ></script>
    <script src="./face-api.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
